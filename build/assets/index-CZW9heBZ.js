!function(){const r=document.createElement("link").relList;if(!(r&&r.supports&&r.supports("modulepreload"))){for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const t of r)if("childList"===t.type)for(const r of t.addedNodes)"LINK"===r.tagName&&"modulepreload"===r.rel&&e(r)}).observe(document,{childList:!0,subtree:!0})}function e(r){if(r.ep)return;r.ep=!0;const e=function(r){const e={};return r.integrity&&(e.integrity=r.integrity),r.referrerPolicy&&(e.referrerPolicy=r.referrerPolicy),"use-credentials"===r.crossOrigin?e.credentials="include":"anonymous"===r.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(r);fetch(r.href,e)}}();class r{static instance;logs=[];constructor(){}static getInstance(){return r.instance||(r.instance=new r),r.instance}createLogEntry(r,e,t){const n={timestamp:(new Date).toISOString(),level:r,message:e};return t&&(n.data=t),n}info(r,e){const t=this.createLogEntry("info",r,e);this.logs.push(t),console.info(`[AKA-Service] ${t.timestamp} - INFO: ${r}`,e||"")}warn(r,e){const t=this.createLogEntry("warn",r,e);this.logs.push(t),console.warn(`[AKA-Service] ${t.timestamp} - WARN: ${r}`,e||"")}error(r,e){const t=this.createLogEntry("error",r,e);this.logs.push(t),console.error(`[AKA-Service] ${t.timestamp} - ERROR: ${r}`,e||"")}getLogs(){return[...this.logs]}clearLogs(){this.logs=[]}}const e=r.getInstance();class t{configuration=null;loadConfiguration(r){try{this.validateConfiguration(r),this.configuration=r,e.info("Routing configuration loaded successfully",{groupCount:r.routingGroups.length,version:r.version})}catch(t){const r=t instanceof Error?t.message:"Unknown error";throw e.error("Failed to load routing configuration",{error:r}),new Error(`Configuration loading failed: ${r}`)}}findRedirect(r,t){if(e.info("Processing redirect request",{path:r,urlParams:t}),!this.configuration){const r="No routing configuration loaded";return e.error(r),{found:!1,error:r}}try{const n=this.findMatchingGroup(r,t);if(!n)return e.warn("No matching routing group found",{path:r,urlParams:t}),{found:!1,error:"No matching routing group found"};const o=this.findMatchingRouting(n,t);return o?(e.info("Redirect target found",{targetUrl:o.redirectTarget,groupName:n.name,routingName:o.name}),{found:!0,targetUrl:o.redirectTarget,matchedGroup:n.name,matchedRouting:o.name}):(e.warn("No matching routing found in group",{groupName:n.name,urlParams:t}),{found:!1,error:"No matching routing found"})}catch(n){const o=n instanceof Error?n.message:"Unknown error";return e.error("Error during redirect processing",{error:o,path:r,urlParams:t}),{found:!1,error:`Processing error: ${o}`}}}findMatchingGroup(r,t){if(!this.configuration)return null;for(const n of this.configuration.routingGroups)if(n.name.toLowerCase()===r.toLowerCase()){if(n.dependsOnKey&&n.dependsOnValue){const r=t[n.dependsOnKey];if(r!==n.dependsOnValue){e.info("Group dependency not met",{groupName:n.name,requiredKey:n.dependsOnKey,requiredValue:n.dependsOnValue,actualValue:r});continue}}return e.info("Matching routing group found",{groupName:n.name}),n}return null}findMatchingRouting(r,t){for(const n of r.routings){if(n.dependsOnKey&&n.dependsOnValue){const r=t[n.dependsOnKey];if(r!==n.dependsOnValue){e.info("Routing dependency not met",{routingName:n.name,requiredKey:n.dependsOnKey,requiredValue:n.dependsOnValue,actualValue:r});continue}}return e.info("Matching routing found",{routingName:n.name}),n}if(1===r.routings.length){const t=r.routings[0];if(t&&!t.dependsOnKey&&!t.dependsOnValue)return e.info("Using default routing (no dependencies)",{routingName:t.name}),t}return null}validateConfiguration(r){if(!r)throw new Error("Configuration is null or undefined");if(!r.version)throw new Error("Configuration version is required");if(!Array.isArray(r.routingGroups))throw new Error("routingGroups must be an array");if(0===r.routingGroups.length)throw new Error("At least one routing group is required");for(const n of r.routingGroups)this.validateRoutingGroup(n);const e=r.routingGroups.map(r=>r.name.toLowerCase()),t=new Set(e);if(e.length!==t.size)throw new Error("Duplicate routing group names found")}validateRoutingGroup(r){if(!r.name||"string"!=typeof r.name)throw new Error("Routing group name is required and must be a string");if(!Array.isArray(r.routings))throw new Error("Group routings must be an array");if(0===r.routings.length)throw new Error(`Routing group '${r.name}' must have at least one routing`);for(const e of r.routings)this.validateRouting(e,r.name)}validateRouting(r,e){if(!r.name||"string"!=typeof r.name)throw new Error(`Routing name is required in group '${e}'`);if(!r.redirectTarget||"string"!=typeof r.redirectTarget)throw new Error(`Redirect target is required for routing '${r.name}' in group '${e}'`);try{new URL(r.redirectTarget)}catch{throw new Error(`Invalid redirect target URL '${r.redirectTarget}' in routing '${r.name}'`)}}getConfiguration(){return this.configuration}isConfigurationLoaded(){return null!==this.configuration}}class n{static instance;configCache=null;lastLoaded=null;constructor(){}static getInstance(){return n.instance||(n.instance=new n),n.instance}async loadFromFile(r){try{e.info("Loading configuration from file",{configPath:r});const t=await fetch(r);if(!t.ok)throw new Error(`Failed to fetch configuration: ${t.status} ${t.statusText}`);const n=await t.json();return this.configCache=n,this.lastLoaded=new Date,e.info("Configuration loaded successfully from file",{configPath:r,version:n.version,groupCount:n.routingGroups.length}),n}catch(t){const n=t instanceof Error?t.message:"Unknown error";throw e.error("Failed to load configuration from file",{configPath:r,error:n}),new Error(`Configuration loading failed: ${n}`)}}loadFromObject(r){try{return e.info("Loading configuration from object",{version:r.version,groupCount:r.routingGroups.length}),this.validateConfiguration(r),this.configCache=r,this.lastLoaded=new Date,e.info("Configuration loaded successfully from object"),r}catch(t){const r=t instanceof Error?t.message:"Unknown error";throw e.error("Failed to load configuration from object",{error:r}),new Error(`Configuration loading failed: ${r}`)}}getConfiguration(){return this.configCache}isConfigurationAvailable(){return null!==this.configCache}getLastLoaded(){return this.lastLoaded}clearCache(){this.configCache=null,this.lastLoaded=null,e.info("Configuration cache cleared")}async reloadConfiguration(){return this.configCache?(e.info("Configuration reload requested (returning cached version)"),this.configCache):(e.warn("No configuration to reload"),null)}validateConfiguration(r){if(!r||"object"!=typeof r)throw new Error("Configuration must be a valid object");const e=r;if(!e.version||"string"!=typeof e.version)throw new Error("Configuration version is required and must be a string");if(!Array.isArray(e.routingGroups))throw new Error("routingGroups must be an array");return r}}const o=n.getInstance();class i{static parseURLParams(r){const e={};if(!r||r.length<=1)return e;return(r.startsWith("?")?r.slice(1):r).split("&").forEach(r=>{const[t,...n]=r.split("=");if(t){const r=n.join("=");e[decodeURIComponent(t)]=r?decodeURIComponent(r):""}}),e}static extractPath(r){try{let e;if(r.startsWith("http://")||r.startsWith("https://")){e=new URL(r).pathname}else e=r.split("?")[0]||"";return e.startsWith("/")?e.slice(1):e}catch{const e=r.split("?")[0]||"";return e.startsWith("/")?e.slice(1):e}}static isValidURL(r){try{return new URL(r),!0}catch{return!1}}static ensureProtocol(r){return r.startsWith("http://")||r.startsWith("https://")?r:`https://${r}`}}const a=new class{routingService;isInitialized=!1;constructor(){this.routingService=new t}async initialize(r){try{let t;e.info("Initializing AKA Service",{configPath:typeof r}),t="string"==typeof r?await o.loadFromFile(r):o.loadFromObject(r),this.routingService.loadConfiguration(t),this.isInitialized=!0,e.info("AKA Service initialized successfully",{groupCount:t.routingGroups.length,version:t.version})}catch(t){const r=t instanceof Error?t.message:"Unknown error";throw e.error("Failed to initialize AKA Service",{error:r}),new Error(`Service initialization failed: ${r}`)}}processRedirect(r){if(!this.isInitialized)throw new Error("Service not initialized. Call initialize() first.");try{e.info("Processing redirect request",{url:r});const t=i.extractPath(r),n=new URL(r,"https://example.com"),o=i.parseURLParams(n.search);e.info("Parsed URL components",{path:t,urlParams:o});const a=this.routingService.findRedirect(t,o);if(!a.found||!a.targetUrl){const r=a.error||"No redirect target found";throw e.warn("Redirect not found",{path:t,urlParams:o,error:r}),new Error(r)}return e.info("Redirect target found",{targetUrl:a.targetUrl,matchedGroup:a.matchedGroup,matchedRouting:a.matchedRouting}),a.targetUrl}catch(t){const n=t instanceof Error?t.message:"Unknown error";throw e.error("Error processing redirect",{error:n,url:r}),t}}getStatus(){const r=o.getConfiguration(),e={initialized:this.isInitialized,configLoaded:null!==r};r&&(e.configVersion=r.version,e.groupCount=r.routingGroups.length);const t=o.getLastLoaded();return t&&(e.lastConfigLoad=t),e}async reloadConfiguration(){try{e.info("Reloading configuration");const r=await o.reloadConfiguration();r&&(this.routingService.loadConfiguration(r),e.info("Configuration reloaded successfully"))}catch(r){const t=r instanceof Error?r.message:"Unknown error";throw e.error("Failed to reload configuration",{error:t}),r}}};let s=null,c=null,u=null,d=null,l=null,g=null,f=null;function h(){const r=window.location.pathname,t=window.location.search;if("/"!==r&&"/index.html"!==r&&!r.startsWith("/admin"))try{e.info("Processing direct redirect request",{path:r,search:t});const n=r+t,o=a.processRedirect(n);e.info("Redirecting to target URL",{sourceUrl:n,targetUrl:o}),window.location.href=o}catch(n){const o=n instanceof Error?n.message:"Unknown error";e.error("Direct redirect failed",{error:o,path:r,search:t}),function(r){document.body.innerHTML=`\n    <div style="\n      font-family: 'Segoe UI', sans-serif;\n      max-width: 600px;\n      margin: 2rem auto;\n      padding: 2rem;\n      text-align: center;\n      background: #f8f9fa;\n      border-radius: 10px;\n      border-left: 4px solid #dc3545;\n    ">\n      <h1 style="color: #dc3545; margin-bottom: 1rem;">Redirect Error</h1>\n      <p style="color: #666; margin-bottom: 1rem;">The requested URL could not be redirected:</p>\n      <p style="\n        background: #fff;\n        padding: 1rem;\n        border-radius: 5px;\n        font-family: monospace;\n        color: #dc3545;\n        border: 1px solid #f5c6cb;\n      ">${r}</p>\n      <button onclick="window.location.href='/'" style="\n        background: #007bff;\n        color: white;\n        padding: 0.75rem 1.5rem;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n        margin-top: 1rem;\n      ">Go to Home Page</button>\n    </div>\n  `}(o)}}function m(r,e){f&&(f.innerHTML=`<div class="result ${e}">${r}</div>`)}window.testRedirect=function(){if(!g||!f)return void e.error("Test UI elements not found");const r=g.value.trim();if(r)try{e.info("Testing redirect for URL",{testUrl:r});const t=a.processRedirect(r);m(`\n      <strong>✅ Redirect Found!</strong><br>\n      <strong>Source:</strong> ${r}<br>\n      <strong>Target:</strong> <a href="${t}" target="_blank">${t}</a><br>\n      <small>Click the link to test the redirect in a new tab</small>\n    `,"success"),e.info("Test redirect successful",{testUrl:r,redirectTarget:t})}catch(t){const n=t instanceof Error?t.message:"Unknown error";m(`\n      <strong>❌ Redirect Failed</strong><br>\n      <strong>URL:</strong> ${r}<br>\n      <strong>Error:</strong> ${n}\n    `,"error"),e.warn("Test redirect failed",{testUrl:r,error:n})}else m("Please enter a URL to test","error")},window.clearResult=function(){f&&(f.innerHTML=""),g&&(g.value="")},window.setTestUrl=function(r){g&&(g.value=r)},document.addEventListener("DOMContentLoaded",async function(){try{e.info("Initializing AKA Service application");const r=new URLSearchParams(window.location.search);if("true"===r.get("hide"))return document.body.innerHTML='<div style="background: white; width: 100vw; height: 100vh;"></div>',document.body.style.background="white",document.body.style.margin="0",document.body.style.padding="0",await a.initialize("/config.json"),void function(){const r=window.location.pathname,t=window.location.search;try{const n=new URLSearchParams(t);n.delete("hide");const o=n.toString(),i=r+(o?"?"+o:"");if(e.info("Processing hidden redirect request",{path:r,search:o}),"/"===r||"/index.html"===r)if(o){const r=a.processRedirect("/"+o);e.info("Redirecting from root with parameters",{sourceUrl:i,targetUrl:r}),window.location.href=r}else e.info("No redirect target found for root path without parameters");else{const r=a.processRedirect(i);e.info("Redirecting to target URL",{sourceUrl:i,targetUrl:r}),window.location.href=r}}catch(n){const o=n instanceof Error?n.message:"Unknown error";e.error("Hidden redirect failed",{error:o,path:r,search:t}),setTimeout(()=>{"/"===window.location.pathname&&e.info("Staying on white screen due to redirect error")},1e3)}}();s=document.getElementById("service-status"),c=document.getElementById("config-status"),u=document.getElementById("group-count"),d=document.getElementById("config-version"),l=document.getElementById("last-updated"),g=document.getElementById("test-url"),f=document.getElementById("test-result"),await a.initialize("/config.json"),function(){try{const r=a.getStatus();s&&(s.textContent=r.initialized?"Active":"Inactive",s.style.color=r.initialized?"#28a745":"#dc3545"),c&&(c.textContent=r.configLoaded?"Loaded":"Not Loaded",c.style.color=r.configLoaded?"#28a745":"#dc3545"),u&&void 0!==r.groupCount&&(u.textContent=r.groupCount.toString()),d&&r.configVersion&&(d.textContent=r.configVersion),l&&r.lastConfigLoad&&(l.textContent=r.lastConfigLoad.toLocaleString()),e.info("Service status updated",r)}catch(r){const t=r instanceof Error?r.message:"Unknown error";e.error("Failed to update service status",{error:t})}}(),h(),e.info("Application initialized successfully")}catch(r){const t=r instanceof Error?r.message:"Unknown error";e.error("Failed to initialize application",{error:t}),function(r){s&&(s.textContent="Error",s.style.color="#dc3545");c&&(c.textContent=r,c.style.color="#dc3545")}("Failed to initialize service: "+t)}}),window.addEventListener("popstate",h);
//# sourceMappingURL=index-CZW9heBZ.js.map
